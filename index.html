<!DOCTYPE html>
<html>
<head>
<title>Task Manager App</title>
<style>

body {
  font-family: Arial;
  background-color:#f5f5f5;
}
.mainBox {
       width:900px;
       margin:40px auto;
       background:white;
       padding:20px;
       border-radius:8px;
}

.Box button {
        padding:8px 15px;
        margin-right:10px;
        cursor:pointer;
}

.entryForm {
        border:2px solid black;
        padding:15px;
        width:500px;
        margin-top:20px;
}

table {
     width:100%;
     margin-top:20px;
}

th, td {
    border:1px solid black;
    padding:8px;
    text-align:center;
}

.pending {
    background:#ffe1e1;
}

.done {
    background:#d6ffd6;
}

.container {
     width:400px;
     margin:50px auto;
     background:white;
     padding:20px;
     border-radius:8px;
}

.container1 {
     width:400px;
     margin:50px auto;
     background:white;
     padding:20px;
     border-radius:8px;
}
.dashboard {
     width:400px;
     margin:50px auto;
     background:white;
     padding:20px;
     border-radius:8px;
}

#regMsg {
    color:red;
    font-weight:bold;
}
     
.summaryCard {
  width: 800px;
  margin: 50px auto;
  background: white;
  padding: 25px;
  border-radius: 8px;
  text-align: center;
}

.summaryBox {
  border: 2px solid black;
  padding: 20px;
}

.summaryStats {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin: 15px 0;
}

.stat {
  background: #f2f2f2;
  padding: 10px 18px;
  border-radius: 6px;
  font-weight: bold;
}

</style>
</head>

<body>

<div class="container" id="registerPage">
    <h2>Register</h2>

   <label>Username:</label>
   <input type="text" id="regUsername" placeholder="Enter username"><br><br>

   <label>Password:</label>
   <input type="password" id="regPassword" placeholder="Enter password"><br><br>
   
   <label>Role:</label>
   <select id="regRole">
     <option value="">--Select--</option>
     <option value="Manager">Manager</option>
     <option value="Developer">Developer</option>
   </select><br><br>

  <button id="btnRegister">Register</button>
  <button id="btnMoveLogin">Already Resister? Click Login</button>

  <div id="regMsg"></div>
 
</div>
<div class="container1" id="loginPage" style="display:none;">
    <h2>Login</h2>

   <label>Username:</label>
   <input type="text" id="loginUsername" placeholder="Enter username"><br><br>

   <label>Password:</label>
   <input type="password" id="loginPassword" placeholder="Enter password"><br><br>

   <button id="btnLogin">Login</button>
   <button id="btnBackRegister">Back</button>
   <button id="btnSummary">Summary</button>

   <div id="loginMsg"></div>
</div>
<div class="dashboard" id="dashboard" style="display:none;">

    <h3>Welcome, <span id="currentUsername"></span> (<span id="currentRole"></span>)</h3>
    <button onclick="logout()">Logout</button>
   
    <h4>Create / Assign Task</h4>

    <label>Taskname:</label>
    <input type="text" id="taskName"><br><br>
   
    <label>Taskdate:</label>
    <input type="date" id="taskDate"><br><br>

    <label>Assigned To:</label>
      <select id="assignDeveloper">
        <option value="">-- Select Developer --</option>
      </select><br><br>
     <button type="button" id="addTaskBtn">Add Task to Developer</button>
     <button type="button" id="addSelfBtn">Add Task to Myself</button><br><br>

     <div id="taskMsg" style="color:red;font-weight:bold;"></div>

   <div class="Box">
        <button type="button" id="btnTotal">Total Tasks</button>
        <button type="button" id="btnPending">Pending Tasks</button>
        <button type="button" id="btnComplete">Completed Tasks</button>
    </div>

<table>
<thead>
   <tr>
       <th>ID</th>
       <th>Task</th>
       <th>Date</th>
       <th>Type</th>
       <th>Status</th>
       <th>Action</th>
   </tr>
</thead>

 <tbody id="taskBody"></tbody>
</table>

</div>

<div class="dashboard" id="developerDashboard" style="display:none;">

  <h3>Welcome, <span id="devUsername"></span> (Developer)</h3>
  <button onclick="logout()">Logout</button><br><br>

  <div class="Box">
         <button id="devBtnTotal">Total Tasks</button>
         <button id="devBtnPending">Pending Tasks</button>
         <button id="devBtnComplete">Completed Tasks</button>
    </div>

  <table>
  <thead>
     <tr>
         <th>ID</th>
         <th>Task</th>
         <th>Date</th>
         <th>Type</th>
         <th>Status</th>
         <th>Action</th>
     </tr>
  </thead>

   <tbody id="devTaskBody"></tbody>
  </table>

</div>
<div class="summaryCard" id="summaryPage" style="display:none;">

  <div class="summaryBox">

    <h3>System Summary</h3>

    <button onclick="closeSummary()">Back</button>

    <div class="summaryStats">
      <div class="stat" id="sumTotalBox">Total Tasks: 0</div>
      <div class="stat" id="sumOpenBox">Open Tasks: 0</div>
      <div class="stat" id="sumCompletedBox">Completed Tasks: 0</div>
    </div>

    <table>
      <thead>
        <tr>
          <th>User</th>
          <th>Open Tasks</th>
          <th>Completed Tasks</th>
          <th>Completed Today</th>
        </tr>
      </thead>
      <tbody id="summaryTableBody"></tbody>
    </table>

  </div>

</div>

<script>
var users = [];
var currentUser = null;

document.getElementById("btnRegister").onclick = function(){

  var username = document.getElementById("regUsername").value;
  var password = document.getElementById("regPassword").value;
  var role = document.getElementById("regRole").value;

  var regMsg = document.getElementById("regMsg");

  if(username===""||password===""||role===""){
    regMsg.innerText="Fill all fields!";
    return;
  }

  var exists=false;

  for(var i=0;i<users.length;i++){
    if(users[i].username===username){
      exists=true;
      break;
    }
  }

  if(exists){
    regMsg.innerText="User already exists!";
    return;
  }

  users[users.length]={
    username:username,
    password:password,
    role:role
  };
  regUsername.value = "";
  regPassword.value = "";
  regRole.value = "";

  document.getElementById("registerPage").style.display="none";
  document.getElementById("loginPage").style.display="block";
};

document.getElementById("btnMoveLogin").onclick=function(){
  document.getElementById("registerPage").style.display="none";
  document.getElementById("loginPage").style.display="block";
};

document.getElementById("btnBackRegister").onclick = function () {

     loginPage.style.display = "none";
     registerPage.style.display = "block";

     regUsername.value = "";
     regPassword.value = "";
     regRole.value = "";

     document.getElementById("regMsg").innerText = "";
};

btnLogin.onclick = function () {

  const u = loginUsername.value;
  const p = loginPassword.value;

  let exist = false;
  let role = "";

  for (let i = 0; i < users.length; i++) {

    if (users[i].username === u && users[i].password === p) {

      exist = true;
      currentUser = u;
      role = users[i].role;
      break;
    }
  }

  if (!exist) {
    loginMsg.innerText = "Invalid credentials!";
    return;
  }
   loginMsg.innerText = "";

  loginPage.style.display = "none";

 
  if (role === "Manager") {

    dashboard.style.display = "block";
    developerDashboard.style.display = "none";

    currentUsername.innerText = currentUser;
    currentRole.innerText = role;

     loadDevelopers();
    taskApp.showManagerTasks();

  }
 
  if (role === "Developer") {

    dashboard.style.display = "none";
    developerDashboard.style.display = "block";

    devUsername.innerText = currentUser;

    taskApp.showDevTasks();  
  }
};
   document.getElementById("btnSummary").onclick = function () {
   showSummary();
};

function logout() {
  dashboard.style.display = "none";

  if (document.getElementById("developerDashboard")) {
    developerDashboard.style.display = "none";
  }
  loginPage.style.display = "none";

  registerPage.style.display = "block";

  regUsername.value = "";
  regPassword.value = "";
  regRole.value = "";

  loginUsername.value = "";
  loginPassword.value = "";
}

function loadDevelopers() {

  const assignDeveloper = document.getElementById("assignDeveloper");

  assignDeveloper.innerHTML = '<option value="">-- Select Developer --</option>';

  for (let i = 0; i < users.length; i++) {

    if (users[i].role === "Developer") {

      const opt = document.createElement("option");
      opt.value = users[i].username;
      opt.text = users[i].username;

      assignDeveloper.add(opt);   
    }
  }
}

class Task {
  constructor(id, name, date, type, assignedTo) {
    this.id = id;
    this.name = name;
    this.date = date;
    this.type = type;
    this.assignedTo = assignedTo;  
    this.status = "Pending";
  }
}

class TaskManager {
      constructor() {
        this.tasks = [];
        this.devCounter = 1;   
        this.selfCounter = 1;  
}

showManagerTasks() {

  const arr = [];

  for (let i = 0; i < this.tasks.length; i++) {

    if (this.tasks[i].assignedTo === currentUser) {
      arr[arr.length] = this.tasks[i];
    }

  }

  this.displayTasks(arr);
}


addEvents() {

  document.getElementById("btnTotal").onclick = () => taskApp.showManagerTasks();

  document.getElementById("btnPending").onclick = () => {

  const arr = taskApp.tasks.filter(t => t.assignedTo === currentUser && t.status === "Pending");

  taskApp.displayTasks(arr);
};

  document.getElementById("btnComplete").onclick = () => {

  const arr = taskApp.tasks.filter(t => t.assignedTo === currentUser && t.status === "Complete");

  taskApp.displayTasks(arr);
};

  document.getElementById("devBtnTotal").onclick = () => taskApp.showDevTasks();

  document.getElementById("devBtnPending").onclick = () => {
    const arr = taskApp.tasks.filter(t => t.assignedTo === currentUser && t.status === "Pending");
    taskApp.displayDev(arr);
  };

  document.getElementById("devBtnComplete").onclick = () => {
    const arr = taskApp.tasks.filter(t => t.assignedTo === currentUser && t.status === "Complete");
    taskApp.displayDev(arr);
  };
}

displayTasks(list) {
    const taskBody = document.getElementById("taskBody");
    let html = "";

    for (let i = 0; i < list.length; i++) {
        const t = list[i];

        const rowClass = (t.status === "Pending") ? "pending" : "done";

        const btnText = (t.status === "Pending") ? "Done" : "Undo";

        html +=
            "<tr class='" + rowClass + "'>" +
                "<td>" + t.id + "</td>" +
                "<td>" + t.name + "</td>" +
                "<td>" + t.date + "</td>" +
                "<td>" + t.type + "</td>" +
                "<td>" + t.status + "</td>" +
                "<td><button onclick='taskApp.changeStatus(" + t.id + ", \"" + t.assignedTo + "\")'>" + btnText + "</button></td>" +
             "</tr>";
    }

    taskBody.innerHTML = html;
}

changeStatus(id, user) {

  for (let i = 0; i < this.tasks.length; i++) {

   if (this.tasks[i].id === id && this.tasks[i].assignedTo === user) {

      this.tasks[i].status = (this.tasks[i].status === "Pending")? "Complete" : "Pending";
      break;
    }
  }

  if (developerDashboard.style.display === "block") {

    const arr = this.tasks.filter(t => t.assignedTo === currentUser);
    this.displayDev(arr);
  }
 
  else {

    const arr = this.tasks.filter(t => t.assignedTo === currentUser);
    this.displayTasks(arr);

  }

}

showTotal() {
    this.displayTasks(this.tasks);
}

showPending() {
    const pending = [];

    for (let i = 0; i < this.tasks.length; i++) {
        const task = this.tasks[i];  
        if (task.status === "Pending") {
            pending[pending.length] = this.tasks[i]; 
        }  
    }

    this.displayTasks(pending);
}

showDevTasks() {

  const body = document.getElementById("devTaskBody");

  let html = "";

  for (let i = 0; i < this.tasks.length; i++) {

    const t = this.tasks[i];

    if (t.assignedTo === currentUser) {

      const rowClass = (t.status === "Pending") ? "pending" : "done";
      const btnText = (t.status === "Pending") ? "Done" : "Undo";

      html +=
        "<tr class='" + rowClass + "'>" +
        "<td>" + t.id + "</td>" +
        "<td>" + t.name + "</td>" +
        "<td>" + t.date + "</td>" +
        "<td>" + t.type + "</td>" +
        "<td>" + t.status + "</td>" +
       "<td><button onclick='taskApp.changeStatus(" + t.id + ", \"" + t.assignedTo + "\")'>" + btnText + "</button></td>" +
        "</tr>";
    }
  }

  body.innerHTML = html;
}
displayDev(list) {

  const body = document.getElementById("devTaskBody");
  let html = "";

  for (let i = 0; i < list.length; i++) {

    const t = list[i];

    const rowClass = (t.status === "Pending") ? "pending" : "done";
    const btnText = (t.status === "Pending") ? "Done" : "Undo";

   html +=
  "<tr class='" + rowClass + "'>" +
  "<td>" + t.id + "</td>" +
  "<td>" + t.name + "</td>" +
  "<td>" + t.date + "</td>" +
  "<td>" + t.type + "</td>" +
  "<td>" + t.status + "</td>" +
  "<td><button onclick='taskApp.changeStatus(" + t.id + ", \"" + t.assignedTo + "\")'>" + btnText + "</button></td>" +
  "</tr>";
}

  body.innerHTML = html;
}

showComplete() {
    const complete = [];

    for (var i = 0; i < this.tasks.length; i++) {
        if (this.tasks[i].status === "Complete") {
            complete[complete.length] = this.tasks[i];  
        }
    }

    this.displayTasks(complete);
   }
}
document.getElementById("addTaskBtn").onclick = function () {

  const name = taskName.value;
  const date = taskDate.value;
  const dev = assignDeveloper.value;

  if (name === "" || date === "" || dev === "") {
    taskMsg.innerText = "Fill all fields!";
    return;
  }

  taskMsg.innerText = "";

  const task = new Task(taskApp.devCounter,name,date,"Assigned",dev);
  taskApp.devCounter++;

 taskApp.tasks[taskApp.tasks.length] = task;

  taskApp.showManagerTasks();
  taskName.value = "";
  taskDate.value = "";
  assignDeveloper.value = "";
};

document.getElementById("addSelfBtn").onclick = function () {

  const name = taskName.value;
  const date = taskDate.value;

  if (name === "" || date === "") {
    taskMsg.innerText = "Fill all fields!";
    return;
  }

  taskMsg.innerText = "";

 const task = new Task(taskApp.selfCounter,name,date,"Self",currentUser);
 taskApp.selfCounter++;

  taskApp.tasks[taskApp.tasks.length] = task;

  taskApp.showManagerTasks();

  taskName.value = "";
  taskDate.value = "";
};

 const taskApp = new TaskManager();
 taskApp.addEvents();

function showSummary() {

  dashboard.style.display = "none";
  developerDashboard.style.display = "none";
  loginPage.style.display = "none";
  registerPage.style.display = "none";
  
  summaryPage.style.display = "block";

  let total = taskApp.tasks.length;
  let completed = 0;
  let open = 0;

  let userStats = {};

  const today = new Date().toISOString().split("T")[0];

  for (let i = 0; i < taskApp.tasks.length; i++) {

    const t = taskApp.tasks[i];

    if (!userStats[t.assignedTo]) {
      userStats[t.assignedTo] = {
        open: 0,
        completed: 0,
        today: 0
      };
    }

    if (t.status === "Pending") {
      open++;
      userStats[t.assignedTo].open++;
    }

    if (t.status === "Complete") {
      completed++;
      userStats[t.assignedTo].completed++;

      if (t.date === today) {
        userStats[t.assignedTo].today++;
      }
    }
  }

  document.getElementById("sumTotalBox").innerText =
    "Total Tasks: " + total;

  document.getElementById("sumOpenBox").innerText =
    "Open Tasks: " + open;

  document.getElementById("sumCompletedBox").innerText =
    "Completed Tasks: " + completed;

  const body = document.getElementById("summaryTableBody");
  body.innerHTML = "";

  for (let user in userStats) {

    const row = document.createElement("tr");

    let role = "";

  for (let i = 0; i < users.length; i++) {
    if (users[i].username === user) {
      role = users[i].role;
      break;
    }
  }

    row.innerHTML =
     "<td>" + user + " (" + role + ")</td>" +

      "<td>" + userStats[user].open + "</td>" +
      "<td>" + userStats[user].completed + "</td>" +
      "<td>" + userStats[user].today + "</td>";

    body.appendChild(row);
  }
}
function closeSummary() {

  document.getElementById("summaryPage").style.display = "none";
 
  document.getElementById("dashboard").style.display = "none";
  document.getElementById("developerDashboard").style.display = "none";
  document.getElementById("registerPage").style.display = "none";

  document.getElementById("loginUsername").value = "";
  document.getElementById("loginPassword").value = "";

  document.getElementById("loginPage").style.display = "block";
}
</script>
</body>
</html>
